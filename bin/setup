#!/usr/bin/env bash

# Setup results output
__results="
Results:
"

# Test directory location
if [[ ! ${PWD} =~ "dotfiles" ]]; then
    echo "--- ERROR: Must be in the project root to install." ; exit 0
fi

# Determine if we need to switch to the linux branch
read -rp "Which environment? ([l]inux/[m]ac/[a]bort)? " answer
case ${answer:0:1} in
    l|L|linux )
        echo "Checking out branch: linux"
        git checkout --track origin/linux
        __results+="\n* Switched to linux branch"
    ;;
    m|M|mac )
        echo "Continuing with branch: master"
    ;;
    a|A|abort )
        echo "Aborting setup"
        exit 0
    ;;
    * )
        echo "Continuing with normal setup"
    ;;
esac


# Install dotfiles
file="MANIFEST"
project_dir=${PWD}
local_dir=$project_dir/local

while read -r dotfile
do
  ln -s "$project_dir"/"$dotfile" ~/".$dotfile"
done < "$file"
__results+="\n* Setup symlinks to dotfiles in MANIFEST"

for file in "$local_dir"/*; do
  filename=$(basename "$file")
  cp "$file" ~/".$filename"
done
__results+="\n* Copied local config files from dir \"local/\" to $HOME"


# Install Vundle
git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
vim +PluginInstall +qall
__results+="\n* Installed Vundle and packages listed in \"vim/vimrc.bundles\""


# Prompt user to load new environment
__results+="\n\n ---> ACTION REQUIRED: Reload your env by runing \"source ~/.bashrc\" to complete the install."

echo -e "$__results"
exit 0
